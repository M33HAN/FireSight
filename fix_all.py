import os
NL = chr(10)
DQ = chr(34)
with open("docker-compose.yml") as f:
    c = f.read()
c = c.replace("firesight-backend" + NL + "    environment:", "firesight-backend" + NL + "    network_mode: host" + NL + "    environment:")
c = c.replace("firesight-frontend" + NL + "    environment:", "firesight-frontend" + NL + "    network_mode: host" + NL + "    environment:")
c = c.replace("@postgres:", "@localhost:")
c = c.replace("redis://redis:", "redis://localhost:")
c = c.replace(DQ + "minio:", DQ + "localhost:")
with open("docker-compose.yml", "w") as f:
    f.write(c)
print("1. Fixed docker-compose.yml")
with open("frontend/src/lib/api.ts") as f:
    c = f.read()
old_iface = "export interface Camera {" + NL + "  id: number;" + NL + "  name: string;" + NL + "  stream_url: string;" + NL + "  status: " + DQ + "active" + DQ + " | " + DQ + "inactive" + DQ + " | " + DQ + "error" + DQ + ";" + NL + "  location?: string;" + NL + "  created_at?: string;" + NL + "}"
new_iface = "export interface Camera {" + NL + "  id: number;" + NL + "  name: string;" + NL + "  stream_url: string;" + NL + "  is_active: boolean;" + NL + "  detection_enabled: boolean;" + NL + "  detection_categories: string[];" + NL + "  zones: any[];" + NL + "  location: string;" + NL + "  site_id?: number;" + NL + "  created_at?: string;" + NL + "}"
c = c.replace(old_iface, new_iface)
if "startDetection" not in c:
    ins = NL + NL + "  async startDetection(cameraId: number): Promise<any> {" + NL + "    return this.request(" + DQ + "/detection/start/" + DQ + " + cameraId, { method: " + DQ + "POST" + DQ + " });" + NL + "  }" + NL + NL + "  async stopDetection(cameraId: number): Promise<any> {" + NL + "    return this.request(" + DQ + "/detection/stop/" + DQ + " + cameraId, { method: " + DQ + "POST" + DQ + " });" + NL + "  }" + NL
    c = c.replace("  async getDetectionStatus", ins + NL + "  async getDetectionStatus")
with open("frontend/src/lib/api.ts", "w") as f:
    f.write(c)
print("2. Fixed api.ts")
with open("frontend/src/app/cameras/page.tsx") as f:
    c = f.read()
c = c.replace('cam.status === "active"', "cam.is_active")
c = c.replace('cam.status === "error"', "false")
with open("frontend/src/app/cameras/page.tsx", "w") as f:
    f.write(c)
print("3. Fixed cameras page")
os.makedirs("frontend/src/app/live", exist_ok=True)
live = bytes.fromhex("2275736520636c69656e74223b0a0a696d706f7274207b2075736553746174652c207573654566666563742c20757365526566207d2066726f6d20227265616374223b0a696d706f7274207b20566964656f2c20506c61792c20537175617265207d2066726f6d20226c75636964652d7265616374223b0a696d706f7274207b206170692c2043616d6572612c20636f6e6e6563744c69766546656564207d2066726f6d2022402f6c69622f617069223b0a0a6578706f72742064656661756c742066756e6374696f6e204c697665506167652829207b0a2020636f6e7374205b63616d657261732c2073657443616d657261735d203d2075736553746174653c43616d6572615b5d3e285b5d293b0a2020636f6e7374205b73656c656374656443616d6572612c2073657453656c656374656443616d6572615d203d2075736553746174653c43616d657261207c206e756c6c3e286e756c6c293b0a2020636f6e7374205b6973446574656374696e672c207365744973446574656374696e675d203d2075736553746174652866616c7365293b0a2020636f6e7374205b646574656374696f6e732c20736574446574656374696f6e735d203d2075736553746174653c616e795b5d3e285b5d293b0a2020636f6e7374205b6670732c207365744670735d203d2075736553746174652830293b0a2020636f6e7374205b746f74616c446574656374696f6e732c20736574546f74616c446574656374696f6e735d203d2075736553746174652830293b0a2020636f6e7374205b77735374617475732c2073657457735374617475735d203d2075736553746174653c737472696e673e2822646973636f6e6e656374656422293b0a2020636f6e7374205b6572726f722c207365744572726f725d203d207573655374617465282222293b0a2020636f6e7374205b73657373696f6e49642c2073657453657373696f6e49645d203d2075736553746174653c6e756d626572207c206e756c6c3e286e756c6c293b0a2020636f6e7374207773526566203d207573655265663c576562536f636b6574207c206e756c6c3e286e756c6c293b0a2020636f6e7374206672616d65436f756e74526566203d207573655265662830293b0a2020636f6e737420667073496e74657276616c526566203d207573655265663c4e6f64654a532e54696d656f7574207c206e756c6c3e286e756c6c293b0a2020636f6e73742063616e766173526566203d207573655265663c48544d4c43616e766173456c656d656e743e286e756c6c293b0a0a2020757365456666656374282829203d3e207b0a202020206c6f616443616d6572617328293b0a2020202072657475726e202829203d3e207b0a2020202020206966202877735265662e63757272656e74292077735265662e63757272656e742e636c6f736528293b0a20202020202069662028667073496e74657276616c5265662e63757272656e742920636c656172496e74657276616c28667073496e74657276616c5265662e63757272656e74293b0a202020207d3b0a20207d2c205b5d293b0a0a20206173796e632066756e6374696f6e206c6f616443616d657261732829207b0a20202020747279207b0a202020202020636f6e73742064617461203d206177616974206170692e67657443616d6572617328293b0a20202020202073657443616d657261732864617461293b0a20202020202069662028646174612e6c656e677468203e2030202626202173656c656374656443616d657261292073657453656c656374656443616d65726128646174615b305d293b0a202020207d206361746368202865727229207b20636f6e736f6c652e6572726f7228657272293b207d0a20207d0a0a202066756e6374696f6e20636f6e6e656374546f43616d6572612863616d65726149643a206e756d62657229207b0a202020206966202877735265662e63757272656e74292077735265662e63757272656e742e636c6f736528293b0a2020202073657457735374617475732822636f6e6e656374696e6722293b0a20202020736574446574656374696f6e73285b5d293b0a202020206672616d65436f756e745265662e63757272656e74203d20303b0a20202020636f6e7374207773203d20636f6e6e6563744c697665466565642863616d65726149642c2028646174613a20616e7929203d3e207b0a20202020202069662028646174612e74797065203d3d3d2022646574656374696f6e2229207b0a2020202020202020736574446574656374696f6e7328646174612e646574656374696f6e73207c7c205b5d293b0a2020202020202020736574546f74616c446574656374696f6e7328287029203d3e2070202b2028646174612e646574656374696f6e733f2e6c656e677468207c7c203029293b0a20202020202020206672616d65436f756e745265662e63757272656e742b2b3b0a2020202020207d0a202020207d293b0a2020202077732e6f6e6f70656e203d202829203d3e207b2073657457735374617475732822636f6e6e656374656422293b207365744572726f72282222293b20667073496e74657276616c5265662e63757272656e74203d20736574496e74657276616c282829203d3e207b20736574467073286672616d65436f756e745265662e63757272656e74293b206672616d65436f756e745265662e63757272656e74203d20303b207d2c2031303030293b207d3b0a2020202077732e6f6e6572726f72203d202829203d3e207b207365744572726f722822576562536f636b657420636f6e6e656374696f6e206661696c656422293b2073657457735374617475732822646973636f6e6e656374656422293b207d3b0a2020202077732e6f6e636c6f7365203d202829203d3e207b2073657457735374617475732822646973636f6e6e656374656422293b2069662028667073496e74657276616c5265662e63757272656e742920636c656172496e74657276616c28667073496e74657276616c5265662e63757272656e74293b207d3b0a2020202077735265662e63757272656e74203d2077733b0a20207d0a0a20206173796e632066756e6374696f6e207374617274446574656374696f6e2829207b0a20202020696620282173656c656374656443616d657261292072657475726e3b0a202020207365744572726f72282222293b0a20202020747279207b0a202020202020636f6e737420726573203d206177616974206170692e706f737428222f646574656374696f6e2f73746172742f22202b2073656c656374656443616d6572612e6964293b0a20202020202073657453657373696f6e4964287265732e73657373696f6e5f6964293b0a2020202020207365744973446574656374696e672874727565293b0a202020202020736574546f74616c446574656374696f6e732830293b0a202020202020636f6e6e656374546f43616d6572612873656c656374656443616d6572612e6964293b0a202020207d20636174636820286572723a20616e7929207b207365744572726f72286572722e6d657373616765207c7c20224661696c656420746f20737461727420646574656374696f6e22293b207d0a20207d0a0a20206173796e632066756e6374696f6e2073746f70446574656374696f6e2829207b0a20202020696620282173656c656374656443616d657261292072657475726e3b0a20202020747279207b206177616974206170692e706f737428222f646574656374696f6e2f73746f702f22202b2073656c656374656443616d6572612e6964293b207d206361746368202865727229207b20636f6e736f6c652e6572726f7228657272293b207d0a202020207365744973446574656374696e672866616c7365293b2073657453657373696f6e4964286e756c6c293b0a202020206966202877735265662e63757272656e74292077735265662e63757272656e742e636c6f736528293b0a20202020736574446574656374696f6e73285b5d293b207365744670732830293b0a20207d0a0a202072657475726e20280a202020203c64697620636c6173734e616d653d2273706163652d792d34223e0a2020202020203c64697620636c6173734e616d653d22666c6578206974656d732d63656e746572206a7573746966792d6265747765656e223e0a20202020202020203c6469763e0a202020202020202020203c683120636c6173734e616d653d22746578742d32786c20666f6e742d626f6c6420747261636b696e672d7469676874223e4c69766520466565643c2f68313e0a202020202020202020203c7020636c6173734e616d653d22746578742d677261792d353030206d742d3120746578742d736d223e5265616c2d74696d652063616d657261206d6f6e69746f72696e67207769746820414920646574656374696f6e3c2f703e0a20202020202020203c2f6469763e0a20202020202020203c64697620636c6173734e616d653d22666c6578206974656d732d63656e746572206761702d32223e0a202020202020202020203c64697620636c6173734e616d653d7b22772d3220682d3220726f756e6465642d66756c6c2022202b20287773537461747573203d3d3d2022636f6e6e656374656422203f202262672d656d6572616c642d34303020616e696d6174652d70756c736522203a202262672d677261792d36303022297d202f3e0a202020202020202020203c7370616e20636c6173734e616d653d22746578742d787320746578742d677261792d353030223e7b7773537461747573203d3d3d2022636f6e6e656374656422203f20224c69766522203a2022446973636f6e6e6563746564227d3c2f7370616e3e0a20202020202020203c2f6469763e0a2020202020203c2f6469763e0a2020202020207b63616d657261732e6c656e677468203d3d3d2030203f20280a20202020202020203c64697620636c6173734e616d653d2262672d677261792d3930302f3530206261636b64726f702d626c75722d736d20726f756e6465642d786c20626f7264657220626f726465722d77686974652f3520702d313220746578742d63656e746572223e0a202020202020202020203c566964656f20636c6173734e616d653d22772d313620682d3136206d782d6175746f206d622d3420746578742d677261792d37303022202f3e0a202020202020202020203c683320636c6173734e616d653d22746578742d6c6720666f6e742d6d656469756d20746578742d677261792d343030206d622d32223e4e6f2043616d6572617320417661696c61626c653c2f68333e0a202020202020202020203c7020636c6173734e616d653d22746578742d677261792d36303020746578742d736d223e4164642063616d6572617320696e207468652043616d657261732073656374696f6e20746f207374617274206c697665206d6f6e69746f72696e672e3c2f703e0a20202020202020203c2f6469763e0a20202020202029203a20280a20202020202020203c64697620636c6173734e616d653d226772696420677269642d636f6c732d3120786c3a677269642d636f6c732d34206761702d34223e0a202020202020202020203c64697620636c6173734e616d653d22786c3a636f6c2d7370616e2d332073706163652d792d34223e0a2020202020202020202020203c64697620636c6173734e616d653d2262672d677261792d3930302f3530206261636b64726f702d626c75722d736d20726f756e6465642d786c20626f7264657220626f726465722d77686974652f35206f766572666c6f772d68696464656e223e0a20202020202020202020202020203c64697620636c6173734e616d653d22666c6578206974656d732d63656e746572206a7573746966792d6265747765656e2070782d342070792d3320626f726465722d6220626f726465722d77686974652f35223e0a202020202020202020202020202020203c64697620636c6173734e616d653d22666c6578206974656d732d63656e746572206761702d33223e0a2020202020202020202020202020202020203c73656c6563742076616c75653d7b73656c656374656443616d6572613f2e6964207c7c2022227d206f6e4368616e67653d7b286529203d3e207b20636f6e73742063616d203d2063616d657261732e66696e6428286329203d3e20632e6964203d3d3d204e756d62657228652e7461726765742e76616c756529293b206966202863616d29207b20696620286973446574656374696e67292073746f70446574656374696f6e28293b2073657453656c656374656443616d6572612863616d293b207d207d7d20636c6173734e616d653d2262672d77686974652f3520626f7264657220626f726465722d77686974652f313020726f756e6465642d6c672070782d332070792d312e3520746578742d736d20666f6375733a6f75746c696e652d6e6f6e6520666f6375733a626f726465722d6f72616e67652d3530302f353020746578742d7768697465223e0a20202020202020202020202020202020202020207b63616d657261732e6d6170282863616d29203d3e20283c6f7074696f6e206b65793d7b63616d2e69647d2076616c75653d7b63616d2e69647d20636c6173734e616d653d2262672d677261792d393030223e7b63616d2e6e616d657d7b63616d2e6c6f636174696f6e203f2022202d2022202b2063616d2e6c6f636174696f6e203a2022227d3c2f6f7074696f6e3e29297d0a2020202020202020202020202020202020203c2f73656c6563743e0a2020202020202020202020202020202020207b73656c656374656443616d657261202626203c7370616e20636c6173734e616d653d22746578742d787320746578742d677261792d36303020666f6e742d6d6f6e6f223e7b73656c656374656443616d6572612e73747265616d5f75726c7d3c2f7370616e3e7d0a202020202020202020202020202020203c2f6469763e0a202020202020202020202020202020203c64697620636c6173734e616d653d22666c6578206974656d732d63656e746572206761702d32223e0a2020202020202020202020202020202020207b6973446574656374696e67203f20280a20202020202020202020202020202020202020203c627574746f6e206f6e436c69636b3d7b73746f70446574656374696f6e7d20636c6173734e616d653d22666c6578206974656d732d63656e746572206761702d322070782d342070792d312e352062672d7265642d36303020686f7665723a62672d7265642d35303020726f756e6465642d6c6720746578742d736d20666f6e742d6d656469756d207472616e736974696f6e223e3c53717561726520636c6173734e616d653d22772d332e3520682d332e3522202f3e53746f703c2f627574746f6e3e0a20202020202020202020202020202020202029203a20280a20202020202020202020202020202020202020203c627574746f6e206f6e436c69636b3d7b7374617274446574656374696f6e7d2064697361626c65643d7b2173656c656374656443616d6572617d20636c6173734e616d653d22666c6578206974656d732d63656e746572206761702d322070782d342070792d312e352062672d6f72616e67652d36303020686f7665723a62672d6f72616e67652d3530302064697361626c65643a6f7061636974792d353020726f756e6465642d6c6720746578742d736d20666f6e742d6d656469756d207472616e736974696f6e20736861646f772d6c6720736861646f772d6f72616e67652d3530302f3230223e3c506c617920636c6173734e616d653d22772d332e3520682d332e3522202f3e537461727420446574656374696f6e3c2f627574746f6e3e0a202020202020202020202020202020202020297d0a202020202020202020202020202020203c2f6469763e0a20202020202020202020202020203c2f6469763e0a20202020202020202020202020203c64697620636c6173734e616d653d226173706563742d766964656f2062672d626c61636b2072656c617469766520666c6578206974656d732d63656e746572206a7573746966792d63656e746572223e0a202020202020202020202020202020203c63616e766173207265663d7b63616e7661735265667d20636c6173734e616d653d226162736f6c75746520696e7365742d3020772d66756c6c20682d66756c6c206f626a6563742d636f6e7461696e22207374796c653d7b7b20646973706c61793a206973446574656374696e67203f2022626c6f636b22203a20226e6f6e6522207d7d202f3e0a202020202020202020202020202020207b216973446574656374696e67202626203c64697620636c6173734e616d653d22746578742d63656e746572223e3c566964656f20636c6173734e616d653d22772d313620682d3136206d782d6175746f206d622d3420746578742d677261792d38303022202f3e3c7020636c6173734e616d653d22746578742d677261792d36303020746578742d736d223e436c69636b20537461727420446574656374696f6e20746f20626567696e206c697665204149206d6f6e69746f72696e673c2f703e3c2f6469763e7d0a202020202020202020202020202020207b6973446574656374696e67202626207773537461747573203d3d3d2022636f6e6e656374656422202626203c64697620636c6173734e616d653d226162736f6c75746520746f702d33206c6566742d3320666c6578206974656d732d63656e746572206761702d32223e3c7370616e20636c6173734e616d653d22666c6578206974656d732d63656e746572206761702d312e352070782d322070792d312062672d7265642d3630302f393020726f756e64656420746578742d787320666f6e742d6d656469756d223e3c7370616e20636c6173734e616d653d22772d312e3520682d312e3520726f756e6465642d66756c6c2062672d776869746520616e696d6174652d70756c736522202f3e4c4956453c2f7370616e3e3c7370616e20636c6173734e616d653d2270782d322070792d312062672d626c61636b2f363020726f756e64656420746578742d787320746578742d677261792d333030223e7b6670737d204650533c2f7370616e3e3c2f6469763e7d0a202020202020202020202020202020207b6572726f72202626203c64697620636c6173734e616d653d226162736f6c75746520626f74746f6d2d33206c6566742d332072696768742d33223e3c64697620636c6173734e616d653d2262672d7265642d3530302f323020626f7264657220626f726465722d7265642d3530302f333020726f756e6465642d6c672070782d342070792d3220746578742d736d20746578742d7265642d343030223e7b6572726f727d3c2f6469763e3c2f6469763e7d0a20202020202020202020202020203c2f6469763e0a2020202020202020202020203c2f6469763e0a202020202020202020203c2f6469763e0a202020202020202020203c64697620636c6173734e616d653d2273706163652d792d34223e0a2020202020202020202020203c64697620636c6173734e616d653d2262672d677261792d3930302f3530206261636b64726f702d626c75722d736d20726f756e6465642d786c20626f7264657220626f726465722d77686974652f3520702d34223e0a20202020202020202020202020203c683320636c6173734e616d653d22746578742d736d20666f6e742d73656d69626f6c6420746578742d677261792d333030206d622d33223e53657373696f6e2053746174733c2f68333e0a20202020202020202020202020203c64697620636c6173734e616d653d2273706163652d792d33223e0a202020202020202020202020202020203c64697620636c6173734e616d653d22666c6578206a7573746966792d6265747765656e223e3c7370616e20636c6173734e616d653d22746578742d787320746578742d677261792d353030223e5374617475733c2f7370616e3e3c7370616e20636c6173734e616d653d7b22746578742d787320666f6e742d6d656469756d2022202b20286973446574656374696e67203f2022746578742d656d6572616c642d34303022203a2022746578742d677261792d35303022297d3e7b6973446574656374696e67203f202252756e6e696e6722203a202249646c65227d3c2f7370616e3e3c2f6469763e0a202020202020202020202020202020203c64697620636c6173734e616d653d22666c6578206a7573746966792d6265747765656e223e3c7370616e20636c6173734e616d653d22746578742d787320746578742d677261792d353030223e4650533c2f7370616e3e3c7370616e20636c6173734e616d653d22746578742d787320666f6e742d6d6f6e6f20746578742d7768697465223e7b6670737d3c2f7370616e3e3c2f6469763e0a202020202020202020202020202020203c64697620636c6173734e616d653d22666c6578206a7573746966792d6265747765656e223e3c7370616e20636c6173734e616d653d22746578742d787320746578742d677261792d353030223e446574656374696f6e733c2f7370616e3e3c7370616e20636c6173734e616d653d22746578742d787320666f6e742d6d6f6e6f20746578742d7768697465223e7b746f74616c446574656374696f6e737d3c2f7370616e3e3c2f6469763e0a20202020202020202020202020203c2f6469763e0a2020202020202020202020203c2f6469763e0a2020202020202020202020203c64697620636c6173734e616d653d2262672d677261792d3930302f3530206261636b64726f702d626c75722d736d20726f756e6465642d786c20626f7264657220626f726465722d77686974652f3520702d34223e0a20202020202020202020202020203c683320636c6173734e616d653d22746578742d736d20666f6e742d73656d69626f6c6420746578742d677261792d333030206d622d33223e43616d657261733c2f68333e0a20202020202020202020202020203c64697620636c6173734e616d653d2273706163652d792d32223e0a202020202020202020202020202020207b63616d657261732e6d6170282863616d29203d3e20283c627574746f6e206b65793d7b63616d2e69647d206f6e436c69636b3d7b2829203d3e207b20696620286973446574656374696e67292073746f70446574656374696f6e28293b2073657453656c656374656443616d6572612863616d293b207d7d20636c6173734e616d653d7b22772d66756c6c20666c6578206974656d732d63656e746572206761702d332070782d332070792d3220726f756e6465642d6c6720746578742d6c656674207472616e736974696f6e2022202b202873656c656374656443616d6572613f2e6964203d3d3d2063616d2e6964203f202262672d6f72616e67652d3530302f313020626f7264657220626f726465722d6f72616e67652d3530302f333022203a2022686f7665723a62672d77686974652f3520626f7264657220626f726465722d7472616e73706172656e7422297d3e3c566964656f20636c6173734e616d653d22772d3420682d3420746578742d677261792d35303020736872696e6b2d3022202f3e3c64697620636c6173734e616d653d226d696e2d772d30223e3c7020636c6173734e616d653d22746578742d736d20746578742d7768697465207472756e63617465223e7b63616d2e6e616d657d3c2f703e3c2f6469763e3c64697620636c6173734e616d653d7b22772d3220682d3220726f756e6465642d66756c6c206d6c2d6175746f20736872696e6b2d302022202b202863616d2e69735f616374697665203f202262672d656d6572616c642d34303022203a202262672d677261792d36303022297d202f3e3c2f627574746f6e3e29297d0a20202020202020202020202020203c2f6469763e0a2020202020202020202020203c2f6469763e0a202020202020202020203c2f6469763e0a20202020202020203c2f6469763e0a202020202020297d0a202020203c2f6469763e0a2020293b0a7d").decode("utf-8")
with open("frontend/src/app/live/page.tsx", "w") as f:
    f.write(live)
print("4. Wrote live page: " + str(len(live)) + " chars")
print("All done!")
